<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">

<head>
  <title>OSCAL Painter</title>
  <meta charset="utf-8" />
  <style type="text/css" xml:space="preserve" id="pageStyle">

body { background-color: whitesmoke }

.panels {
  margin-top: 0.6em;
  }
  
.panels > * { vertical-align: text-top; outline: thin solid black; padding: 0.4em; margin: 0.25em 0em;
  background-color: whitesmoke }

.boxed.fullwidth { width: 100% }

div.oscal { padding: 0.6em; outline: medium inset forestgreen; background-color: lightgreen }
div.oscal * { margin: 0em}

div.unknown { padding: 0.6em; outline: medium inset red; background-color: pink }
div.unknown * { margin: 0em}

.editbox { width: 100%; box-sizing: border-box; resize: both; }

.codePanel { min-width: 30vw}

.floatButton { float:right; margin-left: 0.6em }

#displayFrame { width: 100%; height: 62vh; resize: both; overflow: auto; }


  </style>
  <link rel="stylesheet" href="../nist-boilerplate.css" type="text/css" />
  <link rel="stylesheet" href="../nist-combined.css"/>
  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script type="text/javascript" id="MathJax-script" async="async"
  src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js">
</script>
  <!-- https://github.com/usnistgov/pages-root/wiki/Adding-NIST-required-branding-and-features-to-your-site -->
  <!-- Google analytics    -->
  <script async="async" type="text/javascript" id="_fed_an_ua_tag" src="https://dap.digitalgov.gov/Universal-Federated-Analytics-Min.js?agency=NIST&subagency=github&pua=UA-66610693-1&yt=true&exts=ppsx,pps,f90,sch,rtf,wrl,txz,m1v,xlsm,msi,xsd,f,tif,eps,mpg,xml,pl,xlt,c">
</script>
<script type="module">
    import { fileXMLContent, spliceIntoPage, xsltEngineForHREF, parseXMLLiteral } from "../lib/xslt-blender.js";

    // todo: replace with something a little less cumbersome?
    window.fileXMLContent = fileXMLContent;
    window.spliceIntoPage = spliceIntoPage;
    window.xsltEngineForHREF = xsltEngineForHREF;
    window.parseXMLLiteral = parseXMLLiteral;

</script>
   
<script type="text/javascript">
     
    let loadedOSCAL = new Document();

    async function loadOSCAL(fileSet) {
      const viewerXSLTEngine = await xsltEngineForHREF('show-loaded-xml.xsl');
      for (const eachFile of fileSet) {
        const anXML = await fileXMLContent(eachFile);
        if (anXML) {
          const resultDocument = viewerXSLTEngine.transformToDocument(anXML);
          loadedOSCAL = anXML;
          spliceIntoPage('OSCALfile', resultDocument, true);
        }
      }
    }
   
    const clearLoad = (loadButtonID, clearDivID) => {
      const clearing = document.getElementById(clearDivID);
      const emptyList = new DataTransfer();
      const noFiles = emptyList.files;
      if (clearing.value) { clearing.value = '' };
      clearing.replaceChildren();
      document.getElementById(loadButtonID).files = noFiles;
    }

    function clearDisplay() {
      document.getElementById('displayFrame').contentDocument.body.replaceChildren();
    }

    function clearAll() {
      clearDisplay();
      clearLoad('loadOSCALButton','OSCALfile');
      clearLoad('loadCSSButton','CSSeditbox');
      loadedOSCAL = undefined;
    }

    function refreshPageCSS() {
      const userCSS = document.getElementById('CSSeditbox').value;
      const frameDocument = document.getElementById('displayFrame').contentDocument;
      const newStyle = frameDocument.createElement('style');
      newStyle.setAttribute('id', 'userCSS');
      newStyle.append(userCSS);
      frameDocument.getElementById('userCSS')?.remove();
      frameDocument.head.append(newStyle);
    }

    // graps text contents of XSLTeditbox and does its best to apply it to the currently loaded document
    async function applyXSLT() {
      // const XSLTLiteral = document.getElementById('XSLTeditbox').value;
      const xsltEngine = await xsltEngineForHREF('oscal-html-port.xsl');

      if (!loadedOSCAL) { alert('Please load your OSCAL XML document'); }
      else {
        const OSCALxml = loadedOSCAL;
        // const ViewerXSLT = parseXMLLiteral(XSLTLiteral);
        // const errorNode = ViewerXSLT.querySelector("parsererror");
        //if (errorNode) { alert("XSLT Stylesheet does not parse") }
        //else {
        //  const xsltEngine = new XSLTProcessor();
          try {
            // xsltEngine.importStylesheet(ViewerXSLT);
            const frameDocument = document.getElementById('displayFrame').contentDocument;
            const transformResult = xsltEngine.transformToFragment(loadedOSCAL, frameDocument);
            frameDocument.body.replaceChildren(); // clears the body
            return frameDocument.body.append(transformResult);
          } catch (e) { alert("Failure applying XSLT 1.0"); console.log(e); }
        // }
      }
    }

    // provided a fileList object by a UI button, pastes its file contents into a textarea
    // does not defend against multiple files
    function dropFileText(fileSet, textareaID) {
      for (const eachFile of fileSet) {
        let theTextArea = document.getElementById(textareaID)
        let frdr = new FileReader();
        frdr.onload = () => theTextArea.value = frdr.result;
        frdr.readAsText(eachFile);
      }
    }

    // mainly cribbed from https://developer.mozilla.org/en-US/docs/Learn/JavaScript/Client-side_web_APIs/Fetching_data
    // grabs  file text contents and drops it into the textarea designated
    function pasteFileContents(HREF, textareaID) {
      const theTextArea = document.getElementById(textareaID);
      fetch(HREF) // returns a promise
        .then( (response) => {
          if (!response.ok) { throw new Error(`HTTP error: ${response.status}`); }
          return response.text();
        } )
        .then( (text) => { theTextArea.value = text; } )
        .catch( (error) => { console.log = `Could not fetch XSLT from ${HREF}: ${error}`; }
        );
    }
    
    </script>
        
</head>

<body>
  <div id="nistheadergoeshere">
    <header class="nist-header" id="nist-header" role="banner">
      
      <a href="https://www.nist.gov/"
        title="National Institute of Standards and Technology"
        class="nist-header__logo-link" rel="home">
        <svg aria-hidden="true" class="nist-header__logo-icon" version="1.1"
          xmlns="http://www.w3.org/2000/svg" width="24" height="32"
          viewBox="0 0 24 32">
          <path
            d="M20.911 5.375l-9.482 9.482 9.482 9.482c0.446 0.446 0.446 1.161 0 1.607l-2.964 2.964c-0.446 0.446-1.161 0.446-1.607 0l-13.25-13.25c-0.446-0.446-0.446-1.161 0-1.607l13.25-13.25c0.446-0.446 1.161-0.446 1.607 0l2.964 2.964c0.446 0.446 0.446 1.161 0 1.607z"
          />
        </svg>
        <svg class="nist-header__logo-image" version="1.1"
          xmlns="http://www.w3.org/2000/svg" viewBox="-237 385.7 109.7 29.3">
          <title>National Institute of Standards and Technology</title>
          <g>
            <path class="st0"
              d="M-231,415h-6v-23.1c0,0,0-4.4,4.4-5.8c4-1.3,6.6,1.3,6.6,1.3l19.7,21.3c1,0.6,1.4,0,1.4-0.6v-22h6.1V409
              c0,1.9-1.6,4.4-4,5.3c-2.4,0.9-4.9,0.9-7.9-1.7l-18.5-20c-0.5-0.5-1.8-0.6-1.8,0.4L-231,415L-231,415z"/>
            <path class="st0"
              d="M-195,386.1h6.1v20.7c0,2.2,1.9,2.2,3.6,2.2h26.8c1.1,0,2.4-1.3,2.4-2.7c0-1.4-1.3-2.8-2.5-2.8H-176
              c-3,0.1-9.2-2.7-9.2-8.5c0-7.1,5.9-8.8,8.6-9h49.4v6.1h-12.3V415h-6v-22.9h-30.2c-2.9-0.2-4.9,4.7-0.2,5.4h18.6
              c2.8,0,7.4,2.4,7.5,8.4c0,6.1-3.6,9-7.5,9H-185c-4.5,0-6.2-1.1-7.8-2.5c-1.5-1.5-1.7-2.3-2.2-5.3L-195,386.1
              C-194.9,386.1-195,386.1-195,386.1z"/>
          </g>
        </svg>
      </a>      
    </header>
  </div>
  <details id="sec-notice">
    <summary>Is this site a preview, demo, mockup or spoof? - <i><b>How you can know</b></i></summary>
    <p><span>The real site domain ends in <code>nist.gov</code></span>&#xA0;<span>The page address shows <code>https://</code></span></p>
  </details>
  <main class="draft">
    <h1>OSCAL Painter</h1>
    <p>Try out your own CSS formatting on your own OSCAL.</p>
    <p>Based on the <a href="index.html">OSCAL Styler</a>, this page lets you load your <a href="https://pages.nist.gov/OSCAL">OSCAL</a> data and style it dynamically with your own CSS. No data is sent to any server.</p>
    <p>The OSCAL Painter offers a <q>play set</q> or playground for users to explore the OSCAL data model and how it can be handled in a browser via an elaborated HTML surrogate or representation. The HTML for the view is produced using a generic stylesheet, which casts OSCAL data into an isomorphic, equivalent and traceable form of HTML. To see the HTML model, use your web developer tools to examine the result of your OSCAL data in transformation, as it populates the page. In addition to a traceable mapping from HTML tags back to OSCAL, this code is also provided with rudimentary linking behaviors, reflecting the linking semantics of the underlying OSCAL data. By targetting this HTML with CSS, a web designer can provide the view with very sophisticated styling to provide a custom or branded <q>look and feel</q>. If the mapping from OSCAL into an HTML surrogate must be adapted, an application like the <a href="index.html">OSCAL Styler</a> comes into play.</p>
    <p>Feedback on this demonstration is welcome on the public <a class="external" href="https://github.com/usnistgov/xslt-blender/issues">Github Issues</a> board. Or contribute
      to community discussions in public <a href="https://pages.nist.gov/OSCAL/contact/">OSCAL</a> channels.</p>

      <details class="boxed" id="loadOSCALpanel">
        <summary>Load OSCAL XML <input type="file" id="loadOSCALButton" accept=".xml, .osc, .oscal"  name="loadOSCALButton" title="Load OSCAL"  onchange="loadOSCAL(this.files); this.closest('details').open = true;" 
        />
          <button style="float:right" onclick="loadedOSCAL = undefined; clearLoad('loadOSCALButton','OSCALfile');">Clear OSCAL</button></summary>
        <div id="OSCALfile">
          <!-- x -->
        </div>
      </details>
  

      <details class="boxed fullwidth"><summary>Load and edit styles
        <button class="clearButton floatButton" onclick="clearDisplay();">Clear Display</button>
        <button class="applyButton floatButton" onclick="applyXSLT(); refreshPageCSS();">Apply&#xA0;Styles</button>
        
    </summary>
    <div class="panels">
      
    <div class="codePanel">
      <p>CSS <input type="file" id="loadCSSButton" accept=".css" name="loadCSSButton" title="Load CSS" onchange="dropFileText(this.files,'CSSeditbox');this.parentElement.parentElement.open = true;"
      />
      <button class="floatButton" onclick="pasteFileContents('oscal-port-html.css','CSSeditbox');">Load starter CSS</button>
      <button class="clearButton floatButton" onclick="clearAll();">Clear All</button>
      <button class="floatButton" onclick="clearLoad('loadCSSButton','CSSeditbox');">Clear</button></p>
      <textarea id="CSSeditbox" class="editbox" spellcheck="false" rows="12">/* an illustration */
/* Some basic CSS demonstrating how to apply rules to OSCAL as represented in an HTML DOM
as delivered by oscal-html-port.xsl */

style { display: none }

body { background-color: lemonchiffon }

* { display: block }

p *, li *, td * { display: inline }
i, em, b, strong, q, code, img, sub, sup { display: inline }

/* in the DOM, OSCAL will be represented by `oscal-` prefixes on element names
   classes are *also* assigned */

oscal-control { padding: 0.5em; border: thin dotted black; margin-top: 0.5em }

oscal-control > .title { font-size:120%; font-weight: bold }

oscal-metadata *:before { content: attr(class) ": " }
     
</textarea>
      
    </div>
    </div>
    </details>
    
    <iframe name="displayFrame" id="displayFrame">Loading frame ...</iframe>

  </div>

    <details class="boxed arrayed">
      <summary>Who is this for</summary>
      <ul>
        <li><a href="https://pages.nist.gov/OSCAL">OSCAL</a> users learning XSLT 1.0 and XPath</li>
        <li>XSLT and XML practitioners learning <a href="https://pages.nist.gov/OSCAL">OSCAL</a></li>
        <li>OSCAL developers sketching and testing ideas with real or mock data</li>
        <li>Any curious students of OSCAL or XSLT</li>
      </ul>
      <p>More information on <a class="external" href="https://www.w3.org/TR/xslt-10/">XSLT 1.0</a> may be found on the <a href="https://github.com/usnistgov/xslt-blender/wiki">Project Wiki</a>.</p>
      
      <p>This viewer application is maintained on <a class="external" href="https://github.com/usnistgov/xslt-blender/tree/main/sts-viewer">Github, with documentation</a>.</p>
   </details>
   <details class="boxed arrayed">
    <summary>Is this site a demonstration, a service or both?</summary>
      <p>This application is provided by NIST as an educational demonstration of how a service can be created, not as a fully operational service.</p>
      <p>No guarantees or warranties are provided by NIST that the demo service will be maintained, updated, upgraded, or always available. While NIST intends to keep the demonstration running (with <a class="external" href="https://github.com/usnistgov/xslt-blender">project source code</a> available), NIST also reserves the right to stop supporting it, or to remove or rework it, without any prior warning.</p>
      <p>The best way to ensure access to the application over the long term is to replicate it. See the <a class="external" href="https://github.com/usnistgov/xslt-blender/wiki/Maintenance-and-Support">project wiki page on Maintenance and Support</a> for more details on how these projects are designed to be standards-based, accessible, portable, adaptable over time and unhindered by practical impediments to wide deployment, either technical or legal.</p></details>
  </main>
  <div class="project-footer">
    <p><i>OSCAL Styler</i> is an <a  href="https://pages.nist.gov/xslt-blender">XSLT Blender</a> project using XSLT 1.0 capabilities built into your browser, with no external dependencies.</p>
    <p>Disclaimers apply; no warranty should or can be assumed.</p>
    <p>See the code and contact the developers in the <a class="external" 
      href="https://github.com/usnistgov/xslt-blender">project repository</a>.</p>
  </div>
  <div id="nistfootergoeshere"><footer class="nist-footer">
    <div class="nist-footer__inner">
      <div class="nist-footer__menu" role="navigation">
        <ul>
          <li class="nist-footer__menu-item">
            <a href="https://www.nist.gov/privacy-policy">Site Privacy</a>
          </li>
          <li class="nist-footer__menu-item">
            <a href="https://www.nist.gov/oism/accessibility">Accessibility</a>
          </li>
          <li class="nist-footer__menu-item">
            <a href="https://www.nist.gov/privacy">Privacy Program</a>
          </li>
          <li class="nist-footer__menu-item">
            <a href="https://www.nist.gov/oism/copyrights">Copyrights</a>
          </li>
          <li class="nist-footer__menu-item">
            <a href="https://www.commerce.gov/vulnerability-disclosure-policy">Vulnerability Disclosure</a>
          </li>
          <li class="nist-footer__menu-item">
            <a href="https://www.nist.gov/no-fear-act-policy">No Fear Act Policy</a>
          </li>
          <li class="nist-footer__menu-item">
            <a href="https://www.nist.gov/foia">FOIA</a>
          </li>
          <li class="nist-footer__menu-item">
            <a href="https://www.nist.gov/environmental-policy-statement">Environmental Policy</a>
          </li>
          <li class="nist-footer__menu-item ">
            <a href="https://www.nist.gov/summary-report-scientific-integrity">Scientific Integrity</a>
          </li>
          <li class="nist-footer__menu-item ">
            <a href="https://www.nist.gov/nist-information-quality-standards">Information Quality Standards</a>
          </li>
          <li class="nist-footer__menu-item">
            <a href="https://www.commerce.gov/">Commerce.gov</a>
          </li>
          <li class="nist-footer__menu-item">
            <a href="https://www.science.gov/">Science.gov</a>
          </li>
          <li class="nist-footer__menu-item">
            <a href="https://www.usa.gov/">USA.gov</a>
          </li>
          <li class="nist-footer__menu-item">
            <a href="https://vote.gov/">Vote.gov</a>
          </li>
        </ul>
      </div>
    </div>
    <div class="nist-footer__logo">
      <a href="https://www.nist.gov/" title="National Institute of Standards and Technology" class="nist-footer__logo-link" rel="home">
        <img src="https://pages.nist.gov/nist-header-footer/images/nist_logo_brand_white.svg" alt="National Institute of Standards and Technology logo"/>
      </a>
    </div>
  </footer>
  </div>
  <script>
    
    // initializing by clearing any retained file load
    clearLoad('loadOSCALButton','OSCALfile');
    loadedOSCAL = undefined;
    
  </script>
  
  </body>
</html>
